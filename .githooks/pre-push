#!/usr/bin/env bash
set -euo pipefail

# Temporary override for emergency/manual admin pushes.
if [[ "${ALLOW_MAIN_PUSH:-0}" == "1" ]]; then
  exit 0
fi

while read -r _local_ref _local_sha remote_ref _remote_sha; do
  if [[ "${remote_ref}" == "refs/heads/main" ]]; then
    cat >&2 <<'EOF'
Push blocked: direct pushes to "main" are disabled for this repository.
Use a feature branch and open a pull request instead.

Temporary override (one command only):
  ALLOW_MAIN_PUSH=1 git push <remote> <ref>
EOF
    exit 1
  fi
done

exit 0
